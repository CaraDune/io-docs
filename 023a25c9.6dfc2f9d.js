(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{52:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return r})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return l})),a.d(t,"default",(function(){return s}));var n=a(2),i=a(6),o=(a(0),a(75)),r={title:"Development guidelines"},c={unversionedId:"io-handbook/development-guidelines",id:"io-handbook/development-guidelines",isDocsHomePage:!1,title:"Development guidelines",description:"Principles",source:"@site/docs/io-handbook/development-guidelines.md",slug:"/io-handbook/development-guidelines",permalink:"/io-docs/io-handbook/development-guidelines",editUrl:"https://github.com/pagopa/io-docs/edit/main/docs/io-handbook/development-guidelines.md",version:"current",sidebar:"docs",previous:{title:"Development workflow",permalink:"/io-docs/io-handbook/development-workflow"},next:{title:"Development styleguide",permalink:"/io-docs/io-handbook/development-styleguide"}},l=[{value:"Principles",id:"principles",children:[]},{value:"The Open Source Way",id:"the-open-source-way",children:[]},{value:"General Guidelines",id:"general-guidelines",children:[]},{value:"Workflow automation",id:"workflow-automation",children:[]},{value:"Workstation setup",id:"workstation-setup",children:[]},{value:"NodeJS",id:"nodejs",children:[]},{value:"TypeScript",id:"typescript",children:[]},{value:"Development Style Guide",id:"development-style-guide",children:[]},{value:"Editors, Code Formatting, Linting",id:"editors-code-formatting-linting",children:[]},{value:"Code Quality",id:"code-quality",children:[]},{value:"Third-party libraries",id:"third-party-libraries",children:[]}],p={rightToc:l};function s(e){var t=e.components,a=Object(i.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h3",{id:"principles"},"Principles"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Failure is a mandatory component of success"),". As people, learning and failure go hand in hand.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Learn and adapt from prior learnings"),". Adopt the learnings of continuous improvement: when failure occurs, immediately determine what needs to be done to prevent recurrence and focus on those tasks (e.g. ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Kaizen"}),"Kaizen")," and ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://en.wikipedia.org/wiki/Antifragile"}),"Antifragile"),").")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("strong",{parentName:"p"},"Focus on software and architecture that continually reduces the risk of changes.")," These practices focus on:"),Object(o.b)("ol",{parentName:"li"},Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"isolation")," - truly ensuring that one change cannot impact another. For example, our focus on API design and micro service architecture on the backend is one technique we use to create isolation.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"continuous delivery")," - by releasing small changes continuously to our production environment, we minimize the impact of any one change and significantly decrease time to resolution.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"automation")," - by writing software to manage and implement our processes - including testing, patching and deployment - we focus on capturing our assumptions during the development process and building leverage to ensure our assumptions remain valid over time.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"rollback")," - by ensuring that every application change can be rolled back, we enable faster resolution when problems arise. For example, our practice of managing database schema changes independently of application changes provides the means to ensure every application change can itself be rolled back.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"incremental rollout")," - by rolling out application changes to production incrementally, and verifying that they work, we minimize the impact of a problem before it affects all of our users.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"monitoring and alerting")," - by instrumenting our applications - via logging and external monitoring services - we can capture our assumptions and receive notification on variance to minimize customer impact.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"secure by design")," - We consider security throughout the entire software development life cycle. For example, we deny access by default: That is, something must be true in order for authorization to be granted."))))),Object(o.b)("h3",{id:"the-open-source-way"},"The Open Source Way"),Object(o.b)("p",null,"We are strong proponents of open source software, including the overall process of developing open source software. The Open Source Way is a framework we use to help us answer many questions about software design, deferring to how the open source community works."),Object(o.b)("p",null,"Examples:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"How much documentation should we write?")),Object(o.b)("p",{parentName:"li"},"Let's look at our favorite open source projects and see how their documentation looks. One example we like is the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://facebook.github.io/react/"}),"react project"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("em",{parentName:"p"},"What type of API should we build?")),Object(o.b)("p",{parentName:"li"},"Let's look at our favorite open source projects and look at their APIs. One example we like is ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://stripe.com/docs/api"}),"Stripe")))),Object(o.b)("h3",{id:"general-guidelines"},"General Guidelines"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"All the code is open source and published on GitHub."),Object(o.b)("li",{parentName:"ol"},"Do not use classes unless absolutely necessary; keep data (structures) and behaviors (functions) separate"),Object(o.b)("li",{parentName:"ol"},"Whenever and wherever possible, prefer functional style over imperative and immutable data structure over mutable state."),Object(o.b)("li",{parentName:"ol"},"Keep each individual change small: only change the minimum amount of code needed to accomplish the purpose of your pull request (i.e. do not change the format of the code if that's not the purpose of your change)."),Object(o.b)("li",{parentName:"ol"},"We're not for the 100% coverage religion but you should write tests for the core of your app or usually for the part that is more fragile to changes."),Object(o.b)("li",{parentName:"ol"},"Use the OpenAPI standard to defining REST APIs exposed to clients. Follow the ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://docs.italia.it/italia/piano-triennale-ict/lg-modellointeroperabilita-docs/it/bozza/doc/profili-di-interazione/regole-comuni-rest-soap.html#formato-dei-dati"}),"National Guidelines")," when designing your APIs.")),Object(o.b)("h3",{id:"workflow-automation"},"Workflow automation"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"We maintain ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/pagopa/git-hooks"}),"a collection of git hooks")," that help you automate your workflow. You are encouraged to use, mantain and improve them.")),Object(o.b)("h3",{id:"workstation-setup"},"Workstation setup"),Object(o.b)("p",null,"We prepared ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/pagopa/developer-laptop"}),"a script")," that setup a new developer workstation from scratch. It only supports macOS so far. It's not mandatory to use it nor to setup your machine as the script does. If you find it useful, please consider to give feedback and to keep it update by adding new features and fixing bugs."),Object(o.b)("h3",{id:"nodejs"},"NodeJS"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Use ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/nodenv/nodenv"}),"nodenv")," for setting per-project version of ",Object(o.b)("inlineCode",{parentName:"li"},"node"),"."),Object(o.b)("li",{parentName:"ul"},"Use ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://yarnpkg.com/"}),"yarn")," for package management")),Object(o.b)("h3",{id:"typescript"},"TypeScript"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"When creating a new repository, use the ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/teamdigitale/io-template-typescript"}),"io-template-typescript")," template - the template is also usefus as reference for our tooling and repository structure."),Object(o.b)("li",{parentName:"ul"},"Always use ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/gcanti/io-ts"}),"structured types"),": do not pass in input to unstructured data functions (eg ",Object(o.b)("inlineCode",{parentName:"li"},"JSON")," or ",Object(o.b)("inlineCode",{parentName:"li"},"request.Express"),")"),Object(o.b)("li",{parentName:"ul"},"Use ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://blog.mariusschulz.com/2016/11/03/typescript-2-0-tagged-union-types"}),"tagged types")," and ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://stackoverflow.com/questions/33915459/algebraic-data-types-in-typescript"}),"algebraic types")," instead of classes"),Object(o.b)("li",{parentName:"ul"},"Use ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"http://www.typescriptlang.org/docs/handbook/advanced-types.html#discriminated-unions"}),"discriminated unions")," instead of inheritance"),Object(o.b)("li",{parentName:"ul"},"Favor immutable data structures and operators: use ",Object(o.b)("inlineCode",{parentName:"li"},"const")," instead of ",Object(o.b)("inlineCode",{parentName:"li"},"let"),", ",Object(o.b)("inlineCode",{parentName:"li"},"map")," and ",Object(o.b)("inlineCode",{parentName:"li"},"filter")," instead of ",Object(o.b)("inlineCode",{parentName:"li"},"for")," or ",Object(o.b)("inlineCode",{parentName:"li"},"while")," loops, ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://davidwalsh.name/merge-objects"}),"spread operators")," instead of direct assignments, etc."),Object(o.b)("li",{parentName:"ul"},"If you use classes do not provide setter methods: make sure that all members are readonly"),Object(o.b)("li",{parentName:"ul"},"Favor the use of ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://medium.com/@jamesjefferyuk/javascript-what-are-pure-functions-4d4d5392d49c"}),'"pure" functions')),Object(o.b)("li",{parentName:"ul"},"Use ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/gcanti/fp-ts/blob/master/src/Option.ts"}),"Option")," and avoids ",Object(o.b)("inlineCode",{parentName:"li"},"null")," / ",Object(o.b)("inlineCode",{parentName:"li"},"undefined")," checks"),Object(o.b)("li",{parentName:"ul"},"To handle errors, return ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/gcanti/fp-ts/blob/master/src/Either.ts"}),"Either")," instead of throwing exceptions"),Object(o.b)("li",{parentName:"ul"},"use ",Object(o.b)("inlineCode",{parentName:"li"},"Promises")," instead of callbacks for the asynchronous code. Limits the use of callbacks to interaction with existing libraries (ideally you wrap promisify callbaks though)"),Object(o.b)("li",{parentName:"ul"},"Consider using ",Object(o.b)("inlineCode",{parentName:"li"},"async")," / ",Object(o.b)("inlineCode",{parentName:"li"},"await")," instead of ",Object(o.b)("inlineCode",{parentName:"li"},"then")," / ",Object(o.b)("inlineCode",{parentName:"li"},"catch")," if it can make the code more readable"),Object(o.b)("li",{parentName:"ul"},"Use common code (types and functions) defined in ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/teamdigitale/italia-ts-commons"}),"italia-ts-commons")," (e.g. ",Object(o.b)("inlineCode",{parentName:"li"},"NonEmptyString"),", ",Object(o.b)("inlineCode",{parentName:"li"},"DateFromString"),", ",Object(o.b)("inlineCode",{parentName:"li"},"EmailString"),", etc.)"),Object(o.b)("li",{parentName:"ul"},"Use ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/gcanti/io-ts"}),"io-ts")," to defined types that validate at compile and run-time."),Object(o.b)("li",{parentName:"ul"},"Use ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/gcanti/fp-ts"}),"fp-ts")," for functional data structures (i.e. ",Object(o.b)("inlineCode",{parentName:"li"},"Option"),", ",Object(o.b)("inlineCode",{parentName:"li"},"Either"),", ",Object(o.b)("inlineCode",{parentName:"li"},"NonEmptyArray"),", etc...)"),Object(o.b)("li",{parentName:"ul"},"Use ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/teamdigitale/italia-utils"}),"italia-utils")," for generating ",Object(o.b)("inlineCode",{parentName:"li"},"io-ts")," models from OpenAPI specs."),Object(o.b)("li",{parentName:"ul"},"Refer to the ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/typescript-cheatsheets/react-typescript-cheatsheet"}),"React Typescript cheatsheet")," to type React Components")),Object(o.b)("h3",{id:"development-style-guide"},"Development Style Guide"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"A ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"/io-docs/io-handbook/development-styleguide"}),"Style Guide")," with code snippets, common scenarios and mistakes.")),Object(o.b)("h3",{id:"editors-code-formatting-linting"},"Editors, Code Formatting, Linting"),Object(o.b)("p",null,"You are free to use any code editor or IDE you like."),Object(o.b)("p",null,"However, within some repositories, you will find configurations\nfor ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://code.visualstudio.com/"}),"Visual Studio Code")," (VSC).\nVSC is an open source editor and has some features that are essential for the development of this project:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"excellent support for ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"http://www.typescriptlang.org"}),"Typescript")),Object(o.b)("li",{parentName:"ul"},"effective integration with ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://palantir.github.io/tslint/"}),"tslint")),Object(o.b)("li",{parentName:"ul"},"support for indentation ",Object(o.b)("em",{parentName:"li"},"on-save")," via ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/prettier/prettier"}),"prettier"))),Object(o.b)("p",null,"Before every PR, make sure that all the Typescript code (or Javascript)\nis indented by ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/prettier/prettier"}),"prettier"),".\nThe configuration is available in the ",Object(o.b)("inlineCode",{parentName:"p"},".prettierrc")," files in each\nproject root directory."),Object(o.b)("p",null,"If you use VSC, install the ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode"}),"prettier plugin")," and enable ",Object(o.b)("em",{parentName:"p"},"format on save"),"."),Object(o.b)("h3",{id:"code-quality"},"Code Quality"),Object(o.b)("p",null,"To monitor the quality of the code we produce we use some tools\nfor automated code analysis that are well integrated into our development\nworkflow:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://codecov.io"}),"Codecov"),": test coverage"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.codacy.com/"}),"Codacy"),": code quality and security"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://codeclimate.com"}),"Codeclimate"),": code quality and maintainability"),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://snyk.io"}),"Snyk"),": security analysis of dependencies")),Object(o.b)("p",null,"Always check the feedback that these tools automatically provide to each\nPull Request and implement the changes necessary or suggested."),Object(o.b)("h3",{id:"third-party-libraries"},"Third-party libraries"),Object(o.b)("p",null,"IO includes several third-party open source libraries in its components. When including or updating a library it could happen that the library's code needs some changes (e.h. bugfixes). In that case two options can be evaluated:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"fork the original github repository (the one where the library comes from), patch it, and then ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://docs.npmjs.com/files/package.json#github-urls"}),"set the dependency to the forked repo")," from ",Object(o.b)("inlineCode",{parentName:"li"},"package.json")),Object(o.b)("li",{parentName:"ol"},"create a ",Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://www.npmjs.com/package/patch-package"}),"post install patch")," to fix the original library code")))}s.isMDXComponent=!0},75:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return d}));var n=a(0),i=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var p=i.a.createContext({}),s=function(e){var t=i.a.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},b=function(e){var t=s(e.components);return i.a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},m=i.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,r=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),b=s(a),m=n,d=b["".concat(r,".").concat(m)]||b[m]||u[m]||o;return a?i.a.createElement(d,c(c({ref:t},p),{},{components:a})):i.a.createElement(d,c({ref:t},p))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,r=new Array(o);r[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:n,r[1]=c;for(var p=2;p<o;p++)r[p]=a[p];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);